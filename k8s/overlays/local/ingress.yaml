# Ingress for local Kind cluster
# Access via: http://coderev.localhost
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: coderev-ingress
  namespace: coderev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # Increase timeouts for LLM requests
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    # Enable websockets if needed
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
spec:
  ingressClassName: nginx
  rules:
    - host: coderev.localhost
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: coderev-api
                port:
                  number: 80

---
# Alternative: Access via localhost with path prefix
# Useful if you can't modify /etc/hosts
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: coderev-ingress-localhost
  namespace: coderev
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - path: /coderev(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: coderev-api
                port:
                  number: 80